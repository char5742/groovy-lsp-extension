# Groovy LSP Extension - マイルストーン計画

このドキュメントは、Groovy LSP Extensionプロジェクトの段階的な開発計画を定義します。
各マイルストーンは独立して価値を提供し、アジャイル開発の原則に従って順次実装されます。

## Phase 0: PoC - 技術検証

### M0.1: 最小LSPサーバー起動
- [ ] Javaプロジェクト作成（Gradle設定のみ）
- [ ] LSP4Jライブラリ導入
- [ ] 空のLanguageServerを起動するだけのmainメソッド
- [ ] 標準入出力でのJSON-RPC通信確認

### M0.2: VSCode拡張機能の最小構成
- [ ] TypeScriptプロジェクト作成
- [ ] package.jsonにGroovy言語登録
- [ ] LSPクライアントがサーバーを起動できることを確認
- [ ] ログ出力で接続確認

### M0.3: 初期化ハンドシェイク
- [ ] initialize/initializedメッセージの実装
- [ ] サーバー能力（capabilities）は空で返す
- [ ] クライアント-サーバー間の接続維持確認
- [ ] シャットダウン処理の実装

## Phase 1: 基礎的な通信とファイル同期

### M1.1: テキストドキュメント同期
- [ ] didOpen/didClose/didChangeの実装
- [ ] メモリ上でのドキュメント管理（Map使用）
- [ ] 変更イベントのログ出力
- [ ] 単体テストの作成

### M1.2: 最初の診断機能
- [ ] 固定メッセージ「Hello from Groovy LSP」を全ファイルに表示
- [ ] PublishDiagnosticsの実装
- [ ] VSCodeで診断メッセージが見えることを確認

### M1.3: Groovyファイル判定
- [ ] .groovyファイルのみに診断を限定
- [ ] ファイル拡張子による判定ロジック
- [ ] 設定ファイル（.groovylsp）の読み込み準備

## Phase 2: 簡単な解析機能

### M2.1: 行カウント機能
- [ ] ファイルの行数をカウントして診断に表示
- [ ] 空行・コメント行の識別
- [ ] Vavrを使ったエラーハンドリングの導入

### M2.2: 基本的な字句解析
- [ ] Groovyキーワードの識別（def, class, if等）
- [ ] 文字列リテラルの識別
- [ ] 単純なトークン分割

### M2.3: 括弧の対応チェック
- [ ] (), {}, []の対応チェック
- [ ] 不一致をエラーとして報告
- [ ] 位置情報（行・列）の正確な取得

## Phase 3: Groovyパーサー統合

### M3.1: Groovyパーサー調査と選定
- [ ] 利用可能なGroovyパーサーの調査
- [ ] 小さなサンプルでの動作確認
- [ ] パーサーライブラリの依存関係追加

### M3.2: ASTの基本構築
- [ ] クラス定義の認識
- [ ] メソッド定義の認識
- [ ] 構文エラーの基本検出

### M3.3: シンボル情報の抽出
- [ ] DocumentSymbolProviderの実装
- [ ] クラス・メソッドのアウトライン表示
- [ ] 階層構造の認識

## Phase 4: 情報提供機能

### M4.1: ホバー機能の骨組み
- [ ] HoverProviderの実装
- [ ] カーソル位置の識別
- [ ] 固定テキスト「Groovy element」を表示

### M4.2: 基本的な型情報
- [ ] 変数宣言の型情報抽出
- [ ] プリミティブ型の認識
- [ ] 型情報をホバーに表示

### M4.3: 定義位置の記録
- [ ] シンボルと定義位置のマッピング
- [ ] ファイル内での定義検索
- [ ] 基本的なスコープ管理

## Phase 5: ナビゲーション基礎

### M5.1: 同一ファイル内ジャンプ
- [ ] DefinitionProviderの実装
- [ ] ローカル変数の定義へジャンプ
- [ ] メソッド呼び出しから定義へ

### M5.2: ドキュメントシンボル検索
- [ ] Ctrl+Shift+Oでのシンボル一覧
- [ ] シンボルの種類アイコン
- [ ] 検索フィルタリング

### M5.3: 基本的な参照検索
- [ ] ReferencesProviderの実装
- [ ] 同一ファイル内の参照検索
- [ ] 使用箇所のハイライト

## Phase 6: Spock認識の第一歩

### M6.1: Spockテストファイル判定
- [ ] Specificationクラスの継承チェック
- [ ] .groovyファイルでのSpock識別
- [ ] テストファイルマーカー

### M6.2: Spockブロック認識
- [ ] given/when/then/expectの識別
- [ ] ブロックラベルの構文チェック
- [ ] 不正なブロック順序の警告

### M6.3: Spockアイコンとデコレーション
- [ ] テストメソッドの特別なアイコン
- [ ] Spockブロックの色分け
- [ ] エディタ装飾の追加

## Phase 7: 補完機能の基礎

### M7.1: キーワード補完
- [ ] CompletionProviderの実装
- [ ] Groovyキーワードリスト
- [ ] 基本的な補完候補表示

### M7.2: 既存シンボル補完
- [ ] ファイル内の変数・メソッド名補完
- [ ] 補完候補のフィルタリング
- [ ] 補完時のカーソル位置調整

### M7.3: Spockキーワード補完
- [ ] given/when/then等の補完
- [ ] whereブロックの追加
- [ ] Spock特有のアサーション補完

## Phase 8: プロジェクト全体の理解

### M8.1: ワークスペース解析
- [ ] 複数ファイルの管理
- [ ] インポート文の解析
- [ ] 依存関係の基本追跡

### M8.2: クロスファイル参照
- [ ] 他ファイルのクラス参照
- [ ] インポートによる解決
- [ ] パッケージ構造の理解

### M8.3: ワークスペースシンボル
- [ ] WorkspaceSymbolProviderの実装
- [ ] 全プロジェクト検索
- [ ] インクリメンタルインデックス

## Phase 9: 高度な補完

### M9.1: メソッドシグネチャヘルプ
- [ ] SignatureHelpProviderの実装
- [ ] パラメータ情報表示
- [ ] オーバーロードの処理

### M9.2: インポート補完
- [ ] 未インポートクラスの提案
- [ ] 自動インポート追加
- [ ] インポート最適化

### M9.3: Groovy DSL対応
- [ ] ビルダーパターンの認識
- [ ] DSLコンテキスト理解
- [ ] 動的メソッド補完

## Phase 10: Spock高度な機能

### M10.1: データテーブル処理
- [ ] whereブロックのテーブル認識
- [ ] カラム補完
- [ ] テーブルフォーマット

### M10.2: テストメソッド生成
- [ ] テスト対象からテスト生成
- [ ] Spockテンプレート
- [ ] データ駆動テスト支援

### M10.3: Spock専用診断
- [ ] アサーション分析
- [ ] Mock/Stub使用チェック
- [ ] テストカバレッジ連携

## Phase 11: リファクタリング

### M11.1: 名前変更
- [ ] RenameProviderの実装
- [ ] シンボルの一括変更
- [ ] プレビュー機能

### M11.2: メソッド抽出
- [ ] 選択範囲からメソッド生成
- [ ] パラメータ推論
- [ ] 適切な配置位置決定

### M11.3: その他のリファクタリング
- [ ] 変数抽出
- [ ] インライン化
- [ ] メソッド移動

## Phase 12: コードアクション

### M12.1: Quick Fix基礎
- [ ] CodeActionProviderの実装
- [ ] 未定義変数の生成
- [ ] インポート追加提案

### M12.2: コード生成
- [ ] Getter/Setter生成
- [ ] コンストラクタ生成
- [ ] equals/hashCode生成

### M12.3: Spock用コードアクション
- [ ] ブロック追加
- [ ] アサーション提案
- [ ] モック生成

## Phase 13: フォーマット

### M13.1: 基本フォーマット
- [ ] DocumentFormattingProviderの実装
- [ ] インデント調整
- [ ] 空白文字の正規化

### M13.2: Groovyスタイル
- [ ] Groovy規約適用
- [ ] 設定可能なルール
- [ ] 範囲フォーマット

### M13.3: オンタイプフォーマット
- [ ] 入力時の自動整形
- [ ] 括弧の自動補完
- [ ] インデント自動調整

## Phase 14: 最適化と拡張

### M14.1: パフォーマンス改善
- [ ] インクリメンタル解析
- [ ] キャッシュ戦略
- [ ] 非同期処理最適化

### M14.2: 設定とカスタマイズ
- [ ] VSCode設定UI
- [ ] プロジェクト別設定
- [ ] ユーザー設定

### M14.3: 統合機能
- [ ] デバッガー連携
- [ ] ビルドツール統合
- [ ] テストランナー連携

## 進捗管理

各マイルストーンは以下の状態を持ちます：
- [ ] 未着手
- [x] 完了
- [~] 進行中（部分的に完了）

マイルストーンの実装順序は、技術的な依存関係とビジネス価値を考慮して決定されます。
各フェーズの完了後、次のフェーズに進む前にレビューとフィードバックを行います。