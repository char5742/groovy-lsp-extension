# ホバー情報アーキテクチャ

このドキュメントは、Groovy LSP Extensionのホバー機能で表示する情報の全体像を整理したものです。

## 概要

ホバー機能は、カーソル位置の要素に関する情報を統合的に表示する機能です。型情報、ドキュメント、アノテーション、使用例など、開発者が必要とする様々な情報を一箇所に集約します。

## ホバー情報の構成要素

### 1. 基本情報セクション

#### 1.1 シグネチャ
- **要素種別**: クラス、メソッド、フィールド、変数、パラメータ等
- **完全修飾名**: パッケージを含む完全な名前
- **型情報**: 宣言型、推論型、ジェネリクス情報
- **修飾子**: public/private/protected、static、final等

例：
```
public static List<String> getUserNames(Map<Integer, User> users)
```

#### 1.2 定義位置
- **ファイルパス**: 定義されているファイル
- **行番号**: 定義位置の行番号
- **所属クラス**: メソッドやフィールドが属するクラス

### 2. ドキュメントセクション

#### 2.1 概要説明
- **JavaDoc/GroovyDocの概要**: 最初の文または段落
- **簡潔な説明**: ドキュメントがない場合の自動生成説明

#### 2.2 詳細説明
- **完全なドキュメント**: JavaDoc/GroovyDocの全文
- **パラメータ説明**: `@param`タグの内容
- **戻り値説明**: `@return`タグの内容
- **例外説明**: `@throws`タグの内容
- **使用例**: `@example`や`@code`ブロック

#### 2.3 メタ情報
- **作成者**: `@author`タグ
- **バージョン**: `@since`タグ
- **非推奨情報**: `@deprecated`タグと代替案
- **関連情報**: `@see`タグのリンク

### 3. 型システム情報

#### 3.1 型階層
- **親クラス**: 継承しているクラス
- **実装インターフェース**: 実装している全インターフェース
- **型パラメータ**: ジェネリクス型の境界情報

#### 3.2 メンバー情報
- **公開メソッド数**: 利用可能なメソッドの数
- **公開フィールド数**: アクセス可能なフィールドの数
- **ネストクラス**: 内部クラスやenum

### 4. アノテーション情報

#### 4.1 適用アノテーション
- **アノテーション名**: `@Override`、`@Test`等
- **アノテーション値**: 設定されているパラメータ値
- **メタアノテーション**: アノテーションに付けられたアノテーション

#### 4.2 特殊アノテーション処理
- **@Deprecated**: 非推奨警告の強調表示
- **@CompileStatic**: 型チェックモードの表示
- **AST変換**: 変換後の実際の構造

### 5. Groovy特有情報

#### 5.1 動的特性
- **メタクラス情報**: 動的に追加されたメソッド/プロパティ
- **カテゴリメソッド**: 利用可能なカテゴリ拡張
- **GDKメソッド**: Groovy Development Kitの拡張メソッド

#### 5.2 クロージャ情報
- **デリゲート**: this/owner/delegateの解決
- **引数型**: 推論されたクロージャ引数の型
- **戻り値型**: クロージャの戻り値型

#### 5.3 DSL情報
- **ビルダーコンテキスト**: 現在のビルダー階層
- **利用可能なDSLメソッド**: コンテキストで使えるメソッド

### 6. Spock特有情報

#### 6.1 テストコンテキスト
- **ブロック種別**: given/when/then/expect等
- **ブロックの役割**: 各ブロックの目的説明

#### 6.2 データ駆動テスト
- **whereブロック変数**: 変数の型と値の範囲
- **データテーブル**: カラムの型情報
- **@Unroll展開**: パラメータ化されたテスト名

#### 6.3 モック情報
- **Mock/Stub種別**: モックかスタブかスパイか
- **インタラクション**: 設定された期待値
- **元の型情報**: モック化される前の型

### 7. 使用状況情報

#### 7.1 参照情報
- **参照カウント**: プロジェクト内での使用回数
- **使用例**: 実際の使用コードの抜粋
- **テストコード**: 関連するテストへのリンク

#### 7.2 パフォーマンス情報
- **複雑度**: メソッドの循環的複雑度
- **警告**: パフォーマンス上の注意点

### 8. コンテキスト依存情報

#### 8.1 スコープ情報
- **有効範囲**: 変数やメソッドのスコープ
- **シャドウイング**: 同名変数の隠蔽警告
- **アクセス可能性**: 現在位置からのアクセス可否

#### 8.2 エラー情報
- **コンパイルエラー**: 該当行のエラー詳細
- **型不一致**: 期待される型と実際の型
- **未解決参照**: 解決できない参照の警告

## 情報の優先順位

1. **最優先**: シグネチャ、型情報、簡潔な説明
2. **高優先**: パラメータ説明、戻り値説明、非推奨警告
3. **中優先**: 詳細ドキュメント、アノテーション、使用例
4. **低優先**: メタ情報、パフォーマンス情報、参照カウント

## 表示フォーマット

```markdown
### クラス名/メソッド名
`完全なシグネチャ`

簡潔な説明文

**型**: 具体的な型情報
**定義**: ファイルパス:行番号

---

#### ドキュメント
詳細な説明...

**パラメータ**:
- `param1`: 説明
- `param2`: 説明

**戻り値**: 説明

**例外**: 
- `Exception1`: 説明

---

#### その他の情報
- アノテーション
- 使用例
- 関連情報
```

## 実装上の考慮事項

### キャッシュ戦略
- JavaDocは変更頻度が低いため積極的にキャッシュ
- 型情報は編集に応じて更新
- 参照カウントは定期的に再計算

### パフォーマンス最適化
- 基本情報を最初に表示し、詳細は遅延ロード
- 大きなドキュメントは折りたたみ可能に
- 非同期で追加情報を取得

### エラーハンドリング
- 情報が取得できない場合は、その旨を明示
- 部分的な情報でも可能な限り表示
- クラッシュを防ぐためのフォールバック

## 今後の拡張

- AIによる使用例の自動生成
- プロジェクト固有のドキュメント規約対応
- 多言語対応（日本語ドキュメント等）
- 図やダイアグラムの表示